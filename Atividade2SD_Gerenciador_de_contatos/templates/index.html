<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Contatos</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f9f9f9; color: #333; }
        h1, h2 { text-align: center; color: #0056b3; }
        .container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .form-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        input[type="text"] { width: calc(100% - 24px); padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex-grow: 1; padding: 12px 15px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 16px; transition: background-color 0.2s; }
        button:hover { opacity: 0.9; }
        .btn-post { background-color: #28a745; }
        .btn-put { background-color: #007bff; }
        .btn-delete { background-color: #dc3545; }
        .btn-get { background-color: #6c757d; }
        #response, #user-list { margin-top: 20px; padding: 15px; border-radius: 4px; background-color: #e9ecef; white-space: pre-wrap; word-wrap: break-word; font-family: "Courier New", Courier, monospace; }
        #response { border-left: 5px solid #007bff; }
        #user-list { border-left: 5px solid #28a745; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gerenciador de Contatos</h1>

        <div class="form-section">
            <h2>Adicionar / Atualizar / Remover</h2>
            <input type="text" id="name" placeholder="Nome">
            <input type="text" id="email" placeholder="E-mail (obrigatório para Adicionar/Atualizar)">
            <div class="btn-group">
                <button class="btn-post" onclick="adicionar()">Adicionar (POST)</button>
                <button class="btn-put" onclick="atualizar()">Atualizar (PUT)</button>
                <button class="btn-delete" onclick="remover()">Remover (DELETE)</button>
            </div>
        </div>

        <div class="form-section">
            <h2>Consultar Contatos</h2>
            <input type="text" id="searchName" placeholder="Buscar por nome (deixe em branco para listar todos)">
             <div class="btn-group">
                <button class="btn-get" onclick="consultar()">Consultar (GET)</button>
            </div>
        </div>

        <h3>Resultado da Última Operação:</h3>
        <pre id="response">Aguardando operação...</pre>

        <h3>Lista de Contatos no Banco:</h3>
        <pre id="user-list">Carregando...</pre>
    </div>

    <script>
        const apiUrl = '/api/contatos';

        
        function limparCampos() {
            document.getElementById('nome').value = '';
            document.getElementById('email').value = '';
            document.getElementById('searchName').value = '';
        }

        async function atualizarLista() {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                document.getElementById('user-list').textContent = data.length > 0 ? JSON.stringify(data, null, 2) : 'Nenhum contato encontrado.';
            } catch (error) {
                document.getElementById('user-list').textContent = 'Erro ao carregar a lista de contatos.';
            }
        }

        async function fazerRequisicao(method, body = null, params = '') {
            const url = params ? `${apiUrl}?${params}` : apiUrl;
            const config = {
                method: method,
                headers: { 'Content-Type': 'application/json' },
            };
            if (body) config.body = JSON.stringify(body);

            try {
                const response = await fetch(url, config);
                const data = await response.json();
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    document.getElementById('response').style.borderColor = '#28a745';
                } else {
                    document.getElementById('response').style.borderColor = '#dc3545';
                }
                
                atualizarLista();
            } catch (error) {
                document.getElementById('response').textContent = `Erro na comunicação com a API: ${error}`;
                document.getElementById('response').style.borderColor = '#dc3545';
            }
        }

        function adicionar() {
            const name = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            if (!name || !email) { 
                alert('Nome e e-mail são obrigatórios para adicionar.'); 
                return; 
            }
            fazerRequisicao('POST', { name, email });
            limparCampos(); 
        }

        function atualizar() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            if (!name || !email) { 
                alert('Nome e e-mail são obrigatórios para atualizar.'); 
                return; 
            }
            fazerRequisicao('PUT', { name, email });
            limparCampos(); 
        }

        function remover() {
            const name = document.getElementById('name').value;
            if (!name) { 
                alert('O nome é obrigatório para remover.'); 
                return; 
            }
            if (confirm(`Tem certeza que deseja remover o contato "${name}"?`)) {
                fazerRequisicao('DELETE', { name });
                limparCampos(); 
            }
        }

        function consultar() {
            const name = document.getElementById('searchName').value;
            const params = name ? new URLSearchParams({ name }).toString() : '';
            fazerRequisicao('GET', null, params);
            limparCampos(); 
        }

        document.addEventListener('DOMContentLoaded', atualizarLista);
    </script>
</body>
</html>